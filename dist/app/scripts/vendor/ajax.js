var $=function(){function a(a,c){var d=Q.defer(),e=c||{};if(e.refresh=e.refresh||!1,this.bindFunction=function(a,b){return function(){return a.apply(b,[b])}},this.stateChange=function(){if(401==this.request.status)d.reject(new Error(this.request.responseURL+" : "+this.request.statusText));else if(4==this.request.readyState&&200==this.request.status&&this.request.responseText){var a=JSON.parse(this.request.responseText);e.refresh||(log("Ajax: storing"),b[this.url]=a,log(b)),d.resolve(a)}},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.url=a,!e.refresh&&b[this.url])log("Ajax: from storage"),d.resolve(b[this.url]);else if(log("Ajax: refresh"),this.postBody=arguments[2]||"",this.request=this.getRequest(),this.request){var f=this.request;f.onreadystatechange=this.bindFunction(this.stateChange,this),f.open("GET",a,!0);for(var g in e.headers)f.setRequestHeader(g,e.headers[g]);f.send(this.postBody)}return d.promise}var b={};return{ajax:function(b,c,d){return new a(b,c,d)}}}();