var MusicPlayerService=function(a){this.element=a,this.isLoaded=!1,this.isPlaying=!1,this.time=30,this.interval=""};MusicPlayerService.prototype.load=function(){log("MusicPlayerService: loading");var a=Q.defer(),b=function(){Settings.audioSupport||(Settings.audioSupport=2),this.isLoaded=!0,log("MusicPlayerService: audioSupport "+Settings.audioSupport),a.resolve(Settings.audioSupport)}.bind(this);return this.isLoaded||(3!==Settings.audioSupport?1===Settings.audioSupport?(log("MusicPlayerService: audioElement buffered"),b()):this.element.buffered.length>0?(log("MusicPlayerService: buffered"),b()):(log("MusicPlayerService: wait for loadedmetadata"),this.element.addEventListener("loadedmetadata",function(){log("MusicPlayerService: loadedmetadata"),b(),this.removeEventListener("loadedmetadata",arguments.callee,!1)},!1)):(log("MusicPlayerService: Settings.audioSupport = 3"),this.onLoaded(this))),a.promise},MusicPlayerService.prototype.play=function(){var a=Q.defer();return this.isPlaying||(log("MusicPlayerService: startPlayer"),this.element.play(),this.element.volume=0,this.element.duration>=Settings.roundLength&&(this.element.currentTime=this.element.duration-Settings.roundLength),this.isPlaying=!0,this.element.addEventListener("timeupdate",function(){Settings.mute||(this.element.currentTime<1?this.element.volume=parseInt(10*this.element.currentTime)/10:this.element.duration-this.element.currentTime<1&&(this.element.volume=parseInt(10*(this.element.duration-this.element.currentTime))/10))}.bind(this),!1),this.element.addEventListener("ended",function(){log("MusicPlayerService: ended"),a.resolve(0),this.interval&&window.clearInterval(this.interval),this.element.removeEventListener("ended",arguments.callee,!1)}.bind(this),!1),this.interval=window.setInterval(function(){log("MusicPlayerService: interval"),this.time=parseInt(this.element.duration-this.element.currentTime)||"",a.notify(this.time)}.bind(this),1e3)),a.promise},MusicPlayerService.prototype.stop=function(){var a=Q.defer();return this.isPlaying&&(log("MusicPlayerService: stopPlayer"),this.element.pause(),this.interval&&window.clearInterval(this.interval),a.resolve(this.time)),a.promise};